# 反爬策略配置

<cite>
**本文档中引用的文件**  
- [config.py](file://config.py#L262-L315)
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L78-L89)
</cite>

## 目录
1. [反爬参数详解](#反爬参数详解)  
2. [策略行为模拟分析](#策略行为模拟分析)  
3. [UP主视频数量适配建议](#up主视频数量适配建议)

## 反爬参数详解

`VIDEO_DOWNLOAD_CONFIG` 配置中的 `anti_crawl` 对象包含多项关键反爬参数，用于模拟人类行为并降低被B站封禁的风险。

- **request_delay_min/max**：控制请求之间的最小和最大延迟时间（单位：秒）。当前配置为最小2秒、最大6秒，通过随机延迟使请求间隔不规律，避免被识别为自动化脚本。
- **max_consecutive**：限制连续请求数量，当前设置为3次。达到该阈值后将触发冷却机制，防止短时间内高频请求。
- **cooldown_time**：设置冷却时间（单位：秒），当前为180秒。在触发连续请求限制或发生错误后，程序会暂停指定时间以恢复“正常用户”行为模式。
- **rotate_user_agent**：启用User-Agent轮换功能。程序从预定义的主流浏览器User-Agent列表中随机选择，模拟不同设备和浏览器访问。
- **rotate_headers**：实现请求头轮换。结合不同的请求头模板（如Chrome、Firefox、Safari），进一步增强请求多样性，提升伪装真实性。
- **session_rotation**：启用会话切换机制。定期重建浏览器上下文或HTTP会话，模拟用户更换身份或重新打开浏览器的行为，有效规避持久性追踪。
- **adaptive_delay**：提供自适应延迟功能。根据服务器响应时间动态调整后续请求的延迟，网络响应越慢则延迟越长，高度模仿真实用户的网络体验。

**Section sources**
- [config.py](file://config.py#L262-L315)

## 策略行为模拟分析

这些反爬策略共同构建了一个高度拟真的访问模型，有效模拟人类用户的浏览行为：

1. **时间行为模拟**：通过 `request_delay_min/max` 和 `adaptive_delay` 实现非固定间隔请求，结合 `max_consecutive` 与 `cooldown_time` 模拟用户短时间活跃后休息的行为周期。
2. **身份多样性模拟**：`rotate_user_agent` 和 `rotate_headers` 使每次请求看起来来自不同的浏览器环境，显著增加平台识别难度。
3. **会话真实性增强**：`session_rotation` 定期更换会话上下文，避免长期使用同一会话导致指纹固化，符合真实用户频繁刷新或重启浏览器的习惯。
4. **异常响应模拟**：当检测到请求失败时，系统自动延长 `cooldown_time` 并增加惩罚性延迟，模拟用户在网络不佳时主动暂停操作的自然反应。

上述策略协同工作，使得爬虫行为在时间分布、设备特征、网络节奏等方面均接近真实用户，极大降低了被B站反爬系统识别和封禁的概率。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L78-L89)
- [config.py](file://config.py#L262-L315)

## UP主视频数量适配建议

根据目标UP主的视频数量，建议调整反爬策略强度以平衡效率与安全性：

- **小型UP主（<50个视频）**：可保持默认配置。由于总量较小，即使采用保守策略也能在合理时间内完成下载，且低强度请求更不易触发风控。
- **中型UP主（50–300个视频）**：建议适度增强策略强度。可将 `max_consecutive` 提升至5次，`request_delay_max` 调整为5秒，在保证安全的前提下提高效率。
- **大型UP主（>300个视频）**：推荐启用完整反爬组合策略。确保 `adaptive_delay` 和 `session_rotation` 开启，并考虑延长 `cooldown_time` 至300秒以上，以应对长时间运行可能引发的动态封禁机制。

无论何种情况，首次请求均应保留 `FIRST_REQUEST_DELAY` 预热机制，并始终启用 `rotate_user_agent` 和 `rotate_headers`，以最大程度模拟真实用户初始访问行为。

**Section sources**
- [config.py](file://config.py#L262-L315)