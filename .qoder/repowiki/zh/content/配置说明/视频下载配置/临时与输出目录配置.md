# 临时与输出目录配置

<cite>
**Referenced Files in This Document**  
- [config.py](file://config.py)
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py)
</cite>

## 目录
1. [临时目录与输出目录的区别与用途](#临时目录与输出目录的区别与用途)
2. [为何需要分离两个目录](#为何需要分离两个目录)
3. [磁盘空间与I/O性能规划建议](#磁盘空间与io性能规划建议)
4. [配置示例](#配置示例)
5. [权限与路径问题注意事项](#权限与路径问题注意事项)

## 临时目录与输出目录的区别与用途

在 `bilibili_cover_crawler_playwright.py` 项目中，`temp_dir` 和 `output_dir` 是两个关键的路径配置项，分别用于不同的目的：

- **`temp_dir`**：该目录用于存储音视频分段下载的临时文件。当程序下载视频时，通常会将视频流和音频流分别下载为 `.m4s` 格式的临时文件，这些文件会被保存在 `temp_dir` 中，直到合并完成。
- **`output_dir`**：该目录是最终合并后的视频文件的保存路径。一旦视频和音频流在 `temp_dir` 中下载完毕，程序会调用 FFmpeg 将它们合并为一个 `.mp4` 文件，并将结果保存到 `output_dir`。

这两个目录的分离确保了下载过程的稳定性和最终文件的完整性。

**Section sources**
- [config.py](file://config.py#L270-L271)
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L38-L39)

## 为何需要分离两个目录

将 `temp_dir` 和 `output_dir` 分离具有以下优势：

1. **防止文件冲突**：如果临时文件和最终文件存放在同一目录，可能会导致文件名冲突或误删。
2. **便于清理**：临时文件在合并完成后即可安全删除，而输出目录中的文件是用户希望保留的成品，不应被自动清理。
3. **提高容错性**：若合并过程失败，临时文件仍可保留，便于后续重试，而不会影响已存在的成品文件。
4. **逻辑清晰**：分离目录使程序的文件管理逻辑更加清晰，便于维护和调试。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L445-L447)

## 磁盘空间与I/O性能规划建议

在配置 `temp_dir` 和 `output_dir` 时，应根据磁盘空间和I/O性能进行合理规划：

- **磁盘空间**：`temp_dir` 需要足够的空间来存储分段文件，其大小通常接近最终视频文件的两倍（视频流 + 音频流）。因此，应确保 `temp_dir` 所在磁盘有足够的可用空间。`output_dir` 则只需容纳最终合并后的文件。
- **I/O性能**：建议将 `temp_dir` 设置在高速磁盘（如SSD）上，以加快分段文件的读写速度，提升下载和合并效率。`output_dir` 可根据用户对成品文件的访问频率决定是否也使用高速磁盘。
- **跨磁盘配置**：可将 `temp_dir` 和 `output_dir` 配置在不同物理磁盘上，以分散I/O负载，避免性能瓶颈。

## 配置示例

在 `config.py` 文件中，`temp_dir` 和 `output_dir` 的默认配置如下：

```python
'temp_dir': 'temp_videos',    # 临时文件目录
'output_dir': 'downloaded_videos',  # 输出目录
```

### 相对路径写法
```python
'temp_dir': 'temp_videos',           # 当前目录下的 temp_videos 文件夹
'output_dir': 'downloads/final'      # 当前目录下的 downloads/final 文件夹
```

### 绝对路径写法
```python
'temp_dir': 'D:/bilibili/temp',      # Windows 绝对路径
'output_dir': '/home/user/videos'    # Linux/macOS 绝对路径
```

**Section sources**
- [config.py](file://config.py#L270-L271)

## 权限与路径问题注意事项

为确保程序正常运行，请注意以下事项：

1. **读写权限**：确保程序对 `temp_dir` 和 `output_dir` 具有读写权限。若目录不存在，程序会尝试创建，但若无写权限则会失败。
2. **路径存在性**：虽然程序会自动创建目录（`mkdir(exist_ok=True)`），但仍需确保父路径存在且可访问。
3. **路径格式**：在Windows系统中使用反斜杠时需转义（`'D:\\temp'`）或使用原始字符串（`r'D:\temp'`），推荐使用正斜杠或跨平台的 `Path` 对象。
4. **避免特殊字符**：路径中避免使用中文或特殊字符，以防编码问题导致路径解析失败。

若因路径问题导致下载失败，程序会抛出异常并提示用户检查配置。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L38-L41)