# 使用指南

<cite>
**本文档引用文件**  
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py)
- [config.py](file://config.py)
- [README.md](file://README.md)
</cite>

## 目录

1. [命令行参数说明](#命令行参数说明)
2. [自动化调用模式](#自动化调用模式)
3. [交互式操作模式](#交互式操作模式)
4. [典型命令示例](#典型命令示例)
5. [程序日志信息解析](#程序日志信息解析)
6. [下载进度监控](#下载进度监控)
7. [爬取范围控制](#爬取范围控制)

## 命令行参数说明

本程序支持多种命令行参数，用于控制爬取行为。以下是所有可用选项及其作用与默认值：

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `uid` | 指定目标用户的UID（位置参数） | 无 |
| `--bv` / `--bvid` | 下载指定BV号的单个视频 | 无 |
| `--download-videos` | 启用用户所有视频的下载功能 | 关闭 |
| `--covers-only` | 仅下载封面（不下载视频） | 启用（默认行为） |
| `--no-covers` | 不下载封面（通常与`--download-videos`配合使用） | 关闭 |
| `--enable-video-download` | 显式启用视频下载功能（用于激活配置） | 关闭 |

**参数作用说明：**
- `uid`：程序将爬取该UID对应用户的所有视频封面或视频。
- `--bv`：直接下载指定BV号的单个视频，无需提供UID。
- `--download-videos`：启用后，程序将下载用户的所有视频文件，并可选择是否同时下载封面。
- `--covers-only`：即使配置中启用了视频下载，也仅执行封面下载任务。
- `--no-covers`：在下载视频时，跳过封面下载步骤，仅保存视频文件。
- `--enable-video-download`：在命令行中显式开启视频下载功能，确保`config.py`中的配置被激活。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L2151-L2312)

## 自动化调用模式

用户可以通过直接运行Python脚本并传入参数来实现自动化调用，无需交互式输入。程序会根据参数自动执行相应任务。

### 调用方式
```bash
python bilibili_cover_crawler_playwright.py [参数]
```

### 参数组合示例
- **仅下载封面**：`python bilibili_cover_crawler_playwright.py 123456`
- **下载视频和封面**：`python bilibili_cover_crawler_playwright.py 123456 --download-videos`
- **仅下载视频**：`python bilibili_cover_crawler_playwright.py 123456 --download-videos --no-covers`
- **下载单个视频**：`python bilibili_cover_crawler_playwright.py --bv BV1234567890`

程序在启动时会解析这些参数，并自动进入相应的执行流程，适用于脚本化或批量处理场景。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L2151-L2312)

## 交互式操作模式

当未提供任何命令行参数时，程序将进入交互式模式，通过命令行提示用户输入相关信息。

### 用户输入流程
1. **启动程序**：运行 `python bilibili_cover_crawler_playwright.py`。
2. **输入UID**：程序提示“🎯 请输入要爬取的用户UID (或者输入 'q' 退出):”，用户输入目标用户的数字UID。
3. **确认操作**：程序显示即将执行的操作模式（如下载封面、视频等），并询问“🚀 即将爬取用户 {uid} 的{action_text}，继续吗? (y/N):”。
4. **执行任务**：用户输入 `y` 或 `yes` 确认后，程序开始执行爬取任务；输入其他内容则取消操作。

### 提示信息
- 若输入非数字的UID，程序会提示“😅 请输入有效的数字UID”并要求重新输入。
- 若用户输入 `q`，程序将输出“🙋‍♂️ 用户取消操作”并退出。
- 在任务执行过程中，程序会实时输出当前状态，如“正在获取第2页数据”、“已跳过已下载文件”等。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L2151-L2312)

## 典型命令示例

结合`README.md`中的使用示例，以下是几种典型命令的完整写法：

```bash
# 示例1：下载UP主123456的所有封面（默认行为）
python bilibili_cover_crawler_playwright.py 123456

# 示例2：下载UP主123456的所有视频和封面
python bilibili_cover_crawler_playwright.py 123456 --download-videos

# 示例3：只下载UP主123456的视频，不下载封面
python bilibili_cover_crawler_playwright.py 123456 --download-videos --no-covers

# 示例4：下载指定的BV号视频
python bilibili_cover_crawler_playwright.py --bv BV1xx4y7w147y

# 示例5：交互式选择模式（不带参数启动）
python bilibili_cover_crawler_playwright.py
```

这些命令涵盖了最常见的使用场景，用户可根据需求灵活组合参数。

**Section sources**
- [README.md](file://README.md#L287-L300)

## 程序日志信息解析

程序在运行过程中会输出多种日志信息，帮助用户了解当前状态：

| 日志信息 | 含义 |
|---------|------|
| `已跳过已下载文件` | 程序检测到目标文件已存在，为避免重复下载而跳过该文件，实现断点续传功能。 |
| `正在获取第2页数据` | 程序正在通过分页机制获取用户视频列表的第二页内容，表示分页功能正常工作。 |
| `✅ 文件已存在，跳过: {filename}` | 视频或封面文件已存在，跳过下载，确保不会重复覆盖。 |
| `⚠️ 距离上次错误太近，额外等待 {x.x} 秒...` | 上次请求失败，程序增加额外延迟以避免触发反爬机制。 |
| `💤 已连续请求 {n} 次，休息 {m} 秒...` | 达到连续请求上限，程序进入休息状态，模拟人类行为。 |
| `合并成功: {output_path}` | 视频和音频流已成功合并为MP4文件。 |
| `失败记录已保存到: {path}` | 下载失败的视频信息已记录到JSON文件，便于后续重试。 |

这些日志信息有助于用户判断程序运行是否正常，并在出现问题时进行故障排查。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L1929-L2128)

## 下载进度监控

程序使用`tqdm`库提供实时下载进度条，用户可以直观地监控任务进度。

### 进度条显示
- **封面下载**：显示“下载封面”进度条，包含成功和失败数量的实时统计。
- **视频下载**：显示“下载视频”进度条，同样包含成功和失败数量的动态更新。

### 任务完成状态识别
- **成功完成**：程序输出“🎉 任务完成！”或“🎉 视频下载完成！”，并显示最终统计信息，如总视频数、成功下载数、失败数量。
- **部分失败**：若存在失败项，程序会列出前10个失败的视频，并提示“... 还有 {n} 个”，同时将完整失败记录保存到`failed_videos.json`文件中。
- **用户中断**：若用户按`Ctrl+C`中断程序，程序会输出“⏹️ 用户中断了程序”，并提示“已下载的文件将保留，下次运行时会自动跳过”，支持断点续传。
- **执行出错**：若程序抛出异常，会输出“😱 程序执行出错: {e}”，并提供故障排除建议。

用户可通过这些输出信息准确判断任务的最终状态。

**Section sources**
- [bilibili_cover_crawler_playwright.py](file://bilibili_cover_crawler_playwright.py#L1870-L2069)

## 爬取范围控制

程序通过参数和配置文件共同控制爬取范围，用户可以灵活调整。

### 控制方式
- **仅下载最新N个视频**：目前程序默认爬取用户所有公开视频。若需限制数量，可通过修改`config.py`中的`PAGINATION_CONFIG['max_pages']`参数间接控制最大处理页数，从而限制总视频数（每页约30个视频）。
- **智能停止**：当实际收集的视频数量达到页面显示的总数时，程序会自动停止，避免不必要的等待。
- **分页处理**：程序自动点击“下一页”按钮，直到没有更多数据或达到`max_pages`限制。

虽然没有直接的“仅下载最新N个”参数，但通过分页机制和数量校验，程序能高效地完成指定范围的爬取任务。

**Section sources**
- [config.py](file://config.py#L287-L300)